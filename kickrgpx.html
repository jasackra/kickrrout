<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Kickr Live Tracker â€” Final</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
  :root{
    --topbar-h:64px;
    --accent:#00aaff;
    --bg-panel: rgba(17,17,17,0.85);
    --panel-radius:12px;
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
  #map{position:fixed; inset:0; z-index:1;}
  /* Topbar */
  #topbar{
    position:fixed; top:8px; left:8px; right:8px; height:var(--topbar-h);
    z-index:10010; background:var(--bg-panel); color:#fff;
    border-radius:var(--panel-radius); display:flex; align-items:center;
    justify-content:space-around; padding:8px 12px; box-shadow:0 6px 18px rgba(0,0,0,0.35);
    backdrop-filter: blur(6px);
  }
  #topbar .cell{display:flex;flex-direction:column;align-items:center;min-width:82px;}
  #topbar .label{font-size:12px;color:rgba(255,255,255,0.75);font-weight:500}
  #topbar .value{font-size:18px;font-weight:700;margin-top:4px}
  @media (max-width:640px){ #topbar{font-size:13px; padding:6px;} #topbar .value{font-size:16px} }

  /* Controls panel sits right below topbar */
  #controls{
    position:fixed; top:calc(8px + var(--topbar-h) + 10px); left:12px; z-index:10011;
    background:rgba(255,255,255,0.95); padding:10px; border-radius:10px; box-shadow:0 6px 14px rgba(0,0,0,0.25);
    display:flex; flex-direction:row; gap:10px; align-items:center;
    backdrop-filter: blur(2px);
  }
  #controls .col{display:flex;flex-direction:column; gap:6px;}
  input[type="number"]{width:84px;padding:6px;border-radius:6px;border:1px solid #ddd}
  button{border:0;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600}
  #themeBtn{background:#111;color:#fff}
  #fullscreenBtn{background:#444;color:#fff}
  #connectBtn{background:#666;color:#fff;min-width:170px;transition:all .22s}
  #connectBtn.connecting{background:#ffcc00;color:#111}
  #connectBtn.connected{background:#0bbf4a;color:#fff}
  #loadFileBtn{background:var(--accent);color:#fff}

  /* small responsive layout for narrow screens */
  @media (max-width:640px){
    #controls{left:8px; right:8px; flex-wrap:wrap}
    #controls .col{width:100%;}
    #connectBtn{min-width:140px}
  }

  /* Summary modal */
  #summary{
    position:fixed; left:50%; top:50%; transform:translate(-50%,-50%); z-index:10020;
    background:#111;color:#fff;padding:18px;border-radius:12px;display:none;min-width:260px;
    box-shadow:0 12px 30px rgba(0,0,0,0.5);
  }
  #summary button{margin-top:12px;background:#0bbf4a;color:#fff;border-radius:8px;padding:8px 12px;border:0}

  /* ensure file input is hidden but accessible by button */
  #gpxfile{display:none}
</style>
</head>
<body>

<!-- Topbar with big values -->
<div id="topbar" aria-hidden="false">
  <div class="cell"><span class="label">Distanz</span><span id="top-distance" class="value">0.00 km</span></div>
  <div class="cell"><span class="label">Zeit</span><span id="top-time" class="value">0:00</span></div>
  <div class="cell"><span class="label">Leistung</span><span id="top-power" class="value">0 W</span></div>
  <div class="cell"><span class="label">HÃ¶henmeter</span><span id="top-hm" class="value">0 m</span></div>
  <div class="cell"><span class="label">Steigung</span><span id="top-slope" class="value">0 %</span></div>
  <div class="cell"><span class="label">Kadenz</span><span id="top-cad" class="value">0 rpm</span></div>
</div>

<!-- Controls under the bar -->
<div id="controls" role="region" aria-label="Steuerung">
  <div class="col">
    <label style="font-size:13px;color:#333">Fahrergewicht (kg)</label>
    <input id="weight" type="number" value="75" min="30" max="150"/>
  </div>

  <div class="col" style="align-items:center">
    <button id="themeBtn" title="Tag / Nacht">ðŸŒž Tag</button>
